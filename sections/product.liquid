{% comment %}
  This section is used in the product template to render product page with
  media, content, and add-to-cart form.

  https://shopify.dev/docs/storefronts/themes/architecture/templates/product
{% endcomment %}

{% assign current_variant = product.selected_or_first_available_variant %}

<div class="product-page-new{% if product.gift_card? or product.type == 'Gift Card' %} product-page--gift-card{% endif %}">
  
  <!-- Left Column: Product Info -->
  <div class="product-col-left">
    <nav class="product-breadcrumb">
      {% if product.collections.size > 0 %}
        <a href="{{ product.collections.first.url }}">{{ product.collections.first.title }}</a>
        <span>/</span>
      {% endif %}
      <span>{{ product.title }}</span>
    </nav>
    
    <div class="product-title-row">
      <h1 class="product-title">{{ product.title }}</h1>
      <span class="product-price">{% render 'price', amount: current_variant.price, product: product %}</span>
    </div>
    
    <!-- Product Info Sections -->
    <div class="product-info-sections">
      {% if product.description != blank %}
      <div class="info-section-static">
        <h3 class="info-section-title">DESCRIPTION</h3>
        <div class="info-section-body">
          {{ product.description }}
        </div>
      </div>
      {% endif %}
      
      {% if product.metafields.custom.details != blank %}
      <div class="info-section-static">
        <h3 class="info-section-title">PRODUCT DETAILS</h3>
        <div class="info-section-body">
          {{ product.metafields.custom.details | metafield_tag | newline_to_br }}
        </div>
      </div>
      {% endif %}
      
      <div class="info-section-static">
        <a href="/policies/shipping-policy" class="info-link">Shipping Policy</a>
      </div>
      
      {% unless product.gift_card? or product.type == 'Gift Card' %}
      <div class="info-section-static size-guide-section">
        <span class="info-link size-guide-trigger">Size Guide</span>
        <div class="size-guide-popup">
          <div class="size-guide-header">
            <span class="size-guide-popup-title">Size Guide</span>
            <div class="unit-toggle">
              <button type="button" class="unit-btn active" data-unit="cm">CM</button>
              <button type="button" class="unit-btn" data-unit="inches">INCHES</button>
            </div>
          </div>
          {% assign product_type_down = product.metafields.custom.type | downcase %}
          {% if product_type_down contains 'hoodie' %}
            <div>{{ product_type_down }}</div>
            <div class="size-guide-table" data-unit="cm">
              <div class="size-row header">
                <span>Size</span><span>Width</span><span>Length</span><span>Sleeve</span>
              </div>
              <div class="size-row"><span>S</span><span>53</span><span>68</span><span>62</span></div>
              <div class="size-row"><span>M</span><span>56</span><span>71</span><span>63</span></div>
              <div class="size-row"><span>L</span><span>59</span><span>74</span><span>64</span></div>
              <div class="size-row"><span>XL</span><span>62</span><span>77</span><span>65</span></div>
            </div>
            <div class="size-guide-table" data-unit="inches" style="display:none;">
              <div class="size-row header">
                <span>Size</span><span>Width</span><span>Length</span><span>Sleeve</span>
              </div>
              <div class="size-row"><span>S</span><span>20.9"</span><span>26.8"</span><span>24.4"</span></div>
              <div class="size-row"><span>M</span><span>22.0"</span><span>28.0"</span><span>24.8"</span></div>
              <div class="size-row"><span>L</span><span>23.2"</span><span>29.1"</span><span>25.2"</span></div>
              <div class="size-row"><span>XL</span><span>24.4"</span><span>30.3"</span><span>25.6"</span></div>
            </div>
          {% else %}
            <div class="size-guide-table" data-unit="cm">
              <div class="size-row header">
                <span>Size</span><span>Width</span><span>Length</span><span>Sleeve</span>
              </div>
              <div class="size-row"><span>S</span><span>46</span><span>70</span><span>20</span></div>
              <div class="size-row"><span>M</span><span>51</span><span>72</span><span>21</span></div>
              <div class="size-row"><span>L</span><span>56</span><span>74</span><span>22</span></div>
              <div class="size-row"><span>XL</span><span>61</span><span>76</span><span>23</span></div>
            </div>
            <div class="size-guide-table" data-unit="inches" style="display:none;">
              <div class="size-row header">
                <span>Size</span><span>Width</span><span>Length</span><span>Sleeve</span>
              </div>
              <div class="size-row"><span>S</span><span>18.1"</span><span>27.6"</span><span>7.9"</span></div>
              <div class="size-row"><span>M</span><span>20.1"</span><span>28.3"</span><span>8.3"</span></div>
              <div class="size-row"><span>L</span><span>22.0"</span><span>29.1"</span><span>8.7"</span></div>
              <div class="size-row"><span>XL</span><span>24.0"</span><span>29.9"</span><span>9.1"</span></div>
            </div>
          {% endif %}
        </div>
      </div>
      {% endunless %}
    </div>
  </div>
  
  <!-- Center Column: Fullscreen Images -->
  <div class="product-col-center" id="product-gallery">
    <div class="product-images-fullscreen" id="product-images-fullscreen">
      {% for image in product.images %}
        <div class="fullscreen-image" data-image-index="{{ forloop.index0 }}">
          <img
            src="{{ image | image_url: width: 1600 }}"
            alt="{{ image.alt | escape }}"
            width="800"
            height="1000"
            loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
            data-zoom-src="{{ image | image_url: width: 2400 }}"
          >
          {% if product.metafields.custom.model_info != blank %}
            <div class="model-info-overlay">
              {{ product.metafields.custom.model_info | metafield_tag }}
            </div>
          {% endif %}
        </div>
      {% endfor %}
      {% if product.images.size == 0 %}
        <div class="no-image-placeholder">
          <p>No Image Available</p>
        </div>
      {% endif %}
    </div>
    
    {% if product.images.size > 1 %}
    <div class="product-thumbnails-corner">
      {% for image in product.images %}
        <button 
          class="thumbnail{% if forloop.first %} active{% endif %}" 
          data-image-index="{{ forloop.index0 }}"
          type="button"
        >
          <img
            src="{{ image | image_url: width: 100 }}"
            alt="{{ image.alt | escape }}"
            width="60"
            height="75"
            loading="lazy"
          >
        </button>
      {% endfor %}
    </div>
    {% endif %}
  </div>
  
  <!-- Right Column: Options & Add to Cart -->
  <div class="product-col-right">
    {% form 'product', product %}
      {% if product.has_only_default_variant == false %}
        <!-- Color Selection (if exists) -->
        {% for option in product.options_with_values %}
          {% assign option_key = option.name | downcase | handleize %}
          {% if option_key contains 'color' or option_key contains 'cor' or option_key contains 'colour' %}
            <div class="product-option-group">
              <div class="option-header-inline">
                <span class="option-name">Select Color</span>
                <span class="option-value-display">{{ option.selected_value }}</span>
              </div>
              <div class="color-swatches">
                {% for value in option.values %}
                  {% assign variant_for_color = product.variants | where: 'option1', value | first %}
                  {% if variant_for_color %}
                    <label class="color-swatch">
                      <input
                        type="radio"
                        name="option-{{ option.position }}"
                        value="{{ value | escape }}"
                        {% if option.selected_value == value %}checked{% endif %}
                      >
                      <span class="swatch-image">
                        <img 
                          src="{{ variant_for_color.featured_image | default: product.featured_image | image_url: width: 80 }}" 
                          alt="{{ value }}"
                          width="50"
                          height="65"
                        >
                      </span>
                    </label>
                  {% endif %}
                {% endfor %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
        
        <!-- Size Selection -->
        {% for option in product.options_with_values %}
          {% assign option_key = option.name | downcase | handleize %}
          {% unless option_key contains 'color' or option_key contains 'cor' or option_key contains 'colour' %}
            <div class="product-option-group">
              <label class="option-name">{{ option.name }}</label>
              <div class="size-options">
                {% for value in option.values %}
                  <label class="size-option">
                    <input
                      type="radio"
                      name="option-{{ option.position }}"
                      value="{{ value | escape }}"
                      {% if option.selected_value == value %}checked{% endif %}
                    >
                    <span class="size-btn">{{ value }}</span>
                  </label>
                {% endfor %}
              </div>
            </div>
          {% endunless %}
        {% endfor %}
      {% endif %}

      <!-- Hidden variant selector -->
      <select name="id" class="variant-selector" style="display: none;">
        {% for variant in product.variants %}
          <option value="{{ variant.id }}" {% if variant == current_variant %}selected{% endif %}>
            {{ variant.title }}
          </option>
        {% endfor %}
      </select>

      <!-- Variant data for JavaScript -->
      <script type="application/json" id="variant-data">
        {
          "variants": [
            {% for variant in product.variants %}
              {% capture price_html %}{% render 'price', amount: variant.price, product: product %}{% endcapture %}
              {
                "id": {{ variant.id | json }},
                "title": {{ variant.title | json }},
                "available": {{ variant.available | json }},
                "inventory_quantity": {{ variant.inventory_quantity | json }},
                "inventory_policy": {{ variant.inventory_policy | json }},
                "inventory_management": {{ variant.inventory_management | json }},
                "price": {{ variant.price | json }},
                "priceHtml": {{ price_html | json }},
                "option1": {{ variant.option1 | json }},
                "option2": {{ variant.option2 | json }},
                "option3": {{ variant.option3 | json }},
                "featured_image": {% if variant.featured_image %}{{ variant.featured_image | image_url: width: 800 | json }}{% else %}null{% endif %}
              }{% unless forloop.last %},{% endunless %}
            {% endfor %}
          ],
          "options": [
            {% for option in product.options %}
              {
                "name": {{ option | json }},
                "values": {{ option.values | json }}
              }{% unless forloop.last %},{% endunless %}
            {% endfor %}
          ]
        }
      </script>

      {% if current_variant.available %}
        <p class="stock-status in-stock">● Buy now orders shipped within 1-2 days.</p>
      {% else %}
        <p class="stock-status out-stock">● Currently out of stock</p>
      {% endif %}

      <button
        type="submit"
        id="add-to-cart-btn"
        class="add-to-cart-btn"
        {% unless current_variant.available %}disabled{% endunless %}
      >
        <span class="btn-text">Add to Cart</span>
        <span class="btn-price">{% render 'price', amount: current_variant.price, product: product %}</span>
      </button>
      <div class="cart-message" style="display: none;"></div>
    {% endform %}
  </div>
</div>

<!-- Image Lightbox -->
<div class="image-lightbox" id="image-lightbox">
  <button class="lightbox-close" type="button" aria-label="Close">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M18 6L6 18M6 6l12 12"/>
    </svg>
  </button>
  <div class="lightbox-content">
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" id="lightbox-image" width="1200" height="1600">
  </div>
  <button class="lightbox-nav lightbox-prev" type="button" aria-label="Previous">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M15 18L9 12L15 6"/>
    </svg>
  </button>
  <button class="lightbox-nav lightbox-next" type="button" aria-label="Next">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M9 18L15 12L9 6"/>
    </svg>
  </button>
</div>

{% stylesheet %}
  /* Override parent shopify-section grid for product page */
  .shopify-section:has(.product-page-new) {
    --content-margin: 0;
    --page-margin: 0;
    grid-template-columns: 1fr !important;
    padding: 0 !important;
    margin: 0 !important;
    width: 100% !important;
  }
  
  /* Override main-content gap for product pages */
  .main-content:has(.product-page-new) {
    gap: 0;
  }
  
  /* New Product Page Layout - Full Width */
  .product-page-new {
    grid-column: 1 / -1 !important; /* Override theme's constrained layout */
    display: grid;
    grid-template-columns: 27% 1fr 25%;
    gap: 0;
    min-height: 100vh;
    width: 100%;
    max-width: 100vw;
    margin: 0;
    margin-top: -150px; /* Go behind navbar */
    padding: 0;
    box-sizing: border-box;
    overflow-x: hidden;
  }

  /* Left Column */
  .product-col-left {
    padding: 240px 30px 25px 30px; /* Extra top padding for navbar */
    z-index: 1;
    background: var(--color-background);
  }
  
  .product-breadcrumb {
    font-size: 11px;
    color: var(--color-description, #666);
    margin-bottom: 25px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  
  .product-breadcrumb a {
    color: var(--color-description, #666);
    text-decoration: none;
  }
  
  .product-breadcrumb a:hover {
    color: var(--color-foreground);
  }
  
  .product-title-row {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: 15px;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--color-border);
  }
  
  .product-title {
    font-size: 18px;
    font-weight: var(--font-heading-weight);
    color: var(--color-title, #000);
    margin: 0;
    line-height: 1.2;
    text-transform: uppercase;
    letter-spacing: 0.02em;
  }
  
  .product-price {
    font-size: 14px;
    color: var(--color-title, #000);
    white-space: nowrap;
  }
  
  /* Info Sections (Static - no accordion) */
  .product-info-sections {
    margin-top: 0;
  }
  
  .info-section-static {
    margin-bottom: 0;
    padding: 18px 0;
    border-bottom: 1px solid var(--color-border);
  }
  
  .info-section-static:last-child {
    border-bottom: none;
  }
  
  .info-section-title {
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.1em;
    color: var(--color-title, #000);
    margin: 0 0 10px 0;
    text-transform: uppercase;
  }
  
  .info-section-body {
    font-size: 13px;
    line-height: 1.6;
    color: var(--color-description, #555);
  }
  
  .info-section-body p {
    margin: 0 0 4px 0;
  }
  
  /* Info Links (Shipping Policy, Size Guide) */
  .info-link {
    font-size: 13px;
    color: var(--color-description, #666);
    text-decoration: underline;
    cursor: pointer;
    transition: color 0.2s;
  }
  
  .info-link:hover {
    color: var(--color-foreground);
  }
  
  /* Size Guide Popup on Hover */
  .size-guide-section {
    position: relative;
  }
  
  .size-guide-trigger {
    display: inline-block;
  }
  
  .size-guide-popup {
    position: absolute;
    left: 0;
    top: 100%;
    margin-top: 10px;
    background: #fff;
    border: 1px solid var(--color-border);
    padding: 20px;
    min-width: 320px;
    z-index: 100;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  }
  
  .size-guide-section:hover .size-guide-popup {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .size-guide-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--color-border);
  }
  
  .size-guide-popup-title {
    font-size: 13px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  
  .unit-toggle {
    display: flex;
    gap: 5px;
  }
  
  .unit-btn {
    padding: 5px 12px;
    font-size: 11px;
    font-weight: 600;
    border: 1px solid var(--color-border);
    background: transparent;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .unit-btn.active {
    background: var(--color-foreground);
    color: var(--color-background);
    border-color: var(--color-foreground);
  }
  
  /* Size Guide Table */
  .size-guide-table {
    margin-top: 10px;
  }
  
  .size-guide-table .size-row {
    display: grid;
    grid-template-columns: 50px repeat(3, 1fr);
    gap: 10px;
    padding: 8px 0;
    font-size: 13px;
    border-bottom: 1px solid var(--color-border);
  }
  
  .size-guide-table .size-row.header {
    font-weight: 600;
    color: var(--color-title, #000);
  }
  
  .size-guide-table .size-row:last-child {
    border-bottom: none;
  }
  
  /* Center Column - Fullscreen Images */
  .product-col-center {
    position: relative;
    height: 100vh;
    overflow: hidden;
    margin: 0px 30px;
  }
  
  .product-images-fullscreen {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow-y: scroll;
    scroll-snap-type: y mandatory;
    scroll-behavior: smooth;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
    -webkit-overflow-scrolling: touch; /* Smooth iOS scrolling */
  }
  
  .product-images-fullscreen::-webkit-scrollbar {
    display: none; /* Chrome/Safari */
  }
  
  .fullscreen-image {
    position: relative;
    height: 100vh;
    scroll-snap-align: start;
    scroll-snap-stop: always;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    cursor: zoom-in;
    overflow: hidden;
    transition: opacity 0.3s ease;
  }
  
  .fullscreen-image img {
    width: 100%;

    transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  
  .model-info-overlay {
    background-color: rgba(88,88,88,0.22);
    position: absolute;
    bottom: 30px;
    left: 0;
    right: 0;
    text-align: center;
    font-size: 12px;
    color: #f8f8f8ff;
    font-weight: 400;
    padding: 8px;
    z-index: 5;
    mix-blend-mode: difference;
  }
  
  /* Thumbnails - Vertical Left Side, aligned to bottom */
  .product-thumbnails-corner {
    position: absolute;
    bottom: 30px;
    left: 15px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    z-index: 10;
  }
  
  .thumbnail {
    width: 50px;
    height: 65px;
    border: 1px solid transparent;
    background: #fff;
    padding: 0;
    cursor: pointer;
    overflow: hidden;
    transition: border-color 0.2s;
    opacity: 0.7;
  }
  
  .thumbnail.active {
    border-color: var(--color-foreground);
    opacity: 1;
  }
  
  .thumbnail:hover {
    opacity: 1;
  }
  
  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .no-image-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 600px;
    background: var(--color-surface);
    color: var(--color-description);
  }
  
  /* Right Column */
  .product-col-right {
    padding: 240px 30px 25px 30px; /* Extra top padding for navbar */
    z-index: 1;
    background: var(--color-background);
  }
  
  .product-option-group {
    margin-bottom: 20px;
  }
  
  .option-header-inline {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }
  
  .option-name {
    font-size: 14px;
    font-weight: 500;
    color: var(--color-title, #000);
    display: block;
    margin-bottom: 12px;
  }
  
  .option-value-display {
    font-size: 14px;
    color: var(--color-description, #666);
  }
  
  /* Color Swatches */
  .color-swatches {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  
  .color-swatch {
    cursor: pointer;
  }
  
  .color-swatch input {
    position: absolute;
    opacity: 0;
  }
  
  .swatch-image {
    display: block;
    width: 50px;
    height: 65px;
    border: 2px solid transparent;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  
  .color-swatch input:checked + .swatch-image {
    border-color: var(--color-foreground);
  }
  
  .swatch-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  /* Size Options */
  .size-options {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  
  .size-option {
    cursor: pointer;
  }
  
  .size-option input {
    position: absolute;
    opacity: 0;
  }
  
  .size-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 50px;
    height: 46px;
    padding: 0 18px;
    border: 1px solid var(--color-border);
    border-radius: 0;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s;
    background: transparent;
  }
  
  .size-option input:checked + .size-btn {
    background: var(--color-foreground);
    color: var(--color-background);
    border-color: var(--color-foreground);
  }
  
  .size-option input:disabled + .size-btn {
    opacity: 0.4;
    cursor: not-allowed;
    text-decoration: line-through;
  }
  
  /* Stock Status */
  .stock-status {
    font-size: 13px;
    margin: 20px 0;
  }
  
  .stock-status.in-stock {
    color: #22c55e;
  }
  
  .stock-status.out-stock {
    color: var(--color-error);
  }
  
  /* Add to Cart Button */
  .add-to-cart-btn {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding: 18px 25px;
    background: var(--color-foreground);
    color: var(--color-background);
    border: none;
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: opacity 0.2s;
  }
  
  .add-to-cart-btn:hover {
    opacity: 0.9;
  }
  
  .add-to-cart-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  .cart-message {
    margin-top: 15px;
    padding: 12px;
    text-align: center;
    font-size: 13px;
  }
  
  .cart-message.success {
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
  }
  
  .cart-message.error {
    background: rgba(239, 68, 68, 0.1);
    color: var(--color-error);
  }
  
  /* Lightbox */
  .image-lightbox {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.95);
    z-index: 9999;
    display: none;
    align-items: center;
    justify-content: center;
  }
  
  .image-lightbox.active {
    display: flex;
  }
  
  .lightbox-close {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    padding: 10px;
  }
  
  .lightbox-content {
    max-width: 90vw;
    max-height: 90vh;
  }
  
  .lightbox-content img {
    max-width: 100%;
    max-height: 90vh;
    object-fit: contain;
  }
  
  .lightbox-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    padding: 20px;
  }
  
  .lightbox-prev { left: 20px; }
  .lightbox-next { right: 20px; }
  
  /* Responsive */
  @media (max-width: 1200px) {
    .product-page-new {
      margin-top: 0;
      grid-template-columns: 1fr 1fr;
      gap: 0;
    }
    
    .product-col-left {
      grid-column: 1;
      grid-row: 2;
      padding: 25px 15px;
    }
    
    .product-col-center {
      grid-column: 1 / -1;
      grid-row: 1;
      height: 70vh;
    }
    
    .fullscreen-image {
      height: 70vh;
    }
    
    .product-col-right {
      grid-column: 2;
      grid-row: 2;
      padding: 25px 15px;
    }
    
    .product-title-row {
      flex-direction: column;
      gap: 5px;
    }
    
    .product-thumbnails-corner {
      bottom: 80px; /* Above model info */
    }
    
    .model-info-overlay {
      bottom: 20px;
    }
  }
  
  @media (max-width: 768px) {
    .product-page-new {
      grid-template-columns: 1fr;
      margin-top: 0;
    }
    
    .product-col-left,
    .product-col-center,
    .product-col-right {
      grid-column: 1;
    }
    
    .product-col-center {
      grid-row: 1;
      height: 75vh;
    }
    
    .fullscreen-image {
      height: 75vh;
    }
    
    .product-col-left {
      grid-row: 2;
      padding: 20px 20px;
    }
    
    .product-col-right {
      grid-row: 3;
      padding: 20px 20px;
    }
    
    .product-thumbnails-corner {
      top: auto;
      bottom: 90px; /* Above model info on mobile */
      left: 15px;
      transform: none;
      flex-direction: row;
      gap: 5px;
    }
    
    .model-info-overlay {
      bottom: 15px;
      font-size: 11px;
      padding: 6px;
    }
    
    .thumbnail {
      width: 38px;
      height: 48px;
    }
    
    .size-guide-popup {
      position: fixed;
      left: 15px;
      right: 15px;
      top: auto;
      bottom: 0;
      min-width: auto;
      transform: translateY(100%);
    }
    
    .size-guide-section:hover .size-guide-popup {
      transform: translateY(0);
    }
    
    .product-title {
      font-size: 16px;
    }
    
    .product-price {
      font-size: 13px;
    }
  }
  
  @media (max-width: 480px) {
    .product-col-center {
      height: 65vh;
    }
    
    .fullscreen-image {
      height: 65vh;
    }
    
    .product-col-left,
    .product-col-right {
      padding: 15px;
    }
    
    .product-thumbnails-corner {
      bottom: 75px;
      left: 10px;
      gap: 4px;
    }
    
    .thumbnail {
      width: 32px;
      height: 42px;
    }
    
    .model-info-overlay {
      bottom: 10px;
      font-size: 10px;
    }
  }
{% endstylesheet %}

{% javascript %}
document.addEventListener('DOMContentLoaded', function() {
  // Fullscreen image gallery with smooth scroll capture
  const gallery = document.getElementById('product-gallery');
  const imagesContainer = document.getElementById('product-images-fullscreen');
  const thumbnails = document.querySelectorAll('.thumbnail');
  const fullscreenImages = document.querySelectorAll('.fullscreen-image');
  let isGalleryScrolling = true;
  let scrollTimeout = null;
  
  // Smooth scroll to image with easing
  function smoothScrollToImage(targetImage) {
    if (!targetImage || !imagesContainer) return;
    
    const targetTop = targetImage.offsetTop;
    imagesContainer.scrollTo({
      top: targetTop,
      behavior: 'smooth'
    });
  }
  
  // Thumbnail click scrolls to image
  thumbnails.forEach(thumb => {
    thumb.addEventListener('click', function() {
      const index = this.dataset.imageIndex;
      const targetImage = document.querySelector(`.fullscreen-image[data-image-index="${index}"]`);
      smoothScrollToImage(targetImage);
    });
  });
  
  // Intersection Observer to update active thumbnail
  if (imagesContainer && fullscreenImages.length > 0) {
    const observerOptions = {
      root: imagesContainer,
      rootMargin: '0px',
      threshold: 0.5
    };
    
    const imageObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const index = entry.target.dataset.imageIndex;
          thumbnails.forEach(t => t.classList.remove('active'));
          const activeThumb = document.querySelector(`.thumbnail[data-image-index="${index}"]`);
          if (activeThumb) activeThumb.classList.add('active');
          
          // Check if we're at the last image
          const lastIndex = fullscreenImages.length - 1;
          if (parseInt(index) === lastIndex) {
            // Small delay to allow animation to complete
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
              const scrolledToBottom = imagesContainer.scrollHeight - imagesContainer.scrollTop <= imagesContainer.clientHeight + 20;
              if (scrolledToBottom) {
                isGalleryScrolling = false;
              }
            }, 100);
          }
        }
      });
    }, observerOptions);
    
    fullscreenImages.forEach(img => imageObserver.observe(img));
    
    // Capture scroll on gallery until all images viewed - smoother wheel handling
    if (gallery) {
      let accumulatedDelta = 0;
      let lastScrollTime = 0;
      
      gallery.addEventListener('wheel', function(e) {
        const now = Date.now();
        
        if (isGalleryScrolling) {
          // Check if at the end
          const atBottom = imagesContainer.scrollHeight - imagesContainer.scrollTop <= imagesContainer.clientHeight + 10;
          const atTop = imagesContainer.scrollTop <= 10;
          
          if (e.deltaY > 0 && atBottom) {
            isGalleryScrolling = false;
            return; // Allow page scroll
          }
          if (e.deltaY < 0 && atTop) {
            return; // Allow page scroll up
          }
          
          e.preventDefault();
          
          // Accumulate delta for smoother scrolling
          if (now - lastScrollTime > 50) {
            accumulatedDelta = 0;
          }
          accumulatedDelta += e.deltaY;
          lastScrollTime = now;
          
          // Apply scroll with momentum feel
          imagesContainer.scrollBy({ 
            top: e.deltaY * 1.2, 
            behavior: 'auto' 
          });
        } else {
          // Re-enable gallery scroll if scrolling back up into view
          const rect = gallery.getBoundingClientRect();
          if (rect.top >= -50 && e.deltaY < 0) {
            isGalleryScrolling = true;
            e.preventDefault();
            imagesContainer.scrollTo({
              top: imagesContainer.scrollHeight - imagesContainer.clientHeight,
              behavior: 'auto'
            });
          }
        }
      }, { passive: false });
      
      // Touch support for mobile
      let touchStartY = 0;
      let touchStartScrollTop = 0;
      
      gallery.addEventListener('touchstart', function(e) {
        touchStartY = e.touches[0].clientY;
        touchStartScrollTop = imagesContainer.scrollTop;
      }, { passive: true });
      
      gallery.addEventListener('touchmove', function(e) {
        if (!isGalleryScrolling) return;
        
        const touchY = e.touches[0].clientY;
        const deltaY = touchStartY - touchY;
        
        const atBottom = imagesContainer.scrollHeight - imagesContainer.scrollTop <= imagesContainer.clientHeight + 10;
        const atTop = imagesContainer.scrollTop <= 10;
        
        if (deltaY > 0 && atBottom) {
          isGalleryScrolling = false;
          return;
        }
        if (deltaY < 0 && atTop) {
          return;
        }
      }, { passive: true });
    }
  }
  
  // Size Guide Unit Toggle
  const unitBtns = document.querySelectorAll('.unit-btn');
  unitBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      const unit = this.dataset.unit;
      unitBtns.forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      
      document.querySelectorAll('.size-guide-table').forEach(table => {
        table.style.display = table.dataset.unit === unit ? 'block' : 'none';
      });
    });
  });
  
  // Lightbox
  const lightbox = document.getElementById('image-lightbox');
  const lightboxImage = document.getElementById('lightbox-image');
  const lightboxClose = document.querySelector('.lightbox-close');
  const lightboxPrev = document.querySelector('.lightbox-prev');
  const lightboxNext = document.querySelector('.lightbox-next');
  let currentLightboxIndex = 0;
  
  if (imagesContainer && lightbox) {
    imagesContainer.addEventListener('click', function(e) {
      if (e.target.tagName === 'IMG') {
        const zoomSrc = e.target.dataset.zoomSrc || e.target.src;
        lightboxImage.src = zoomSrc;
        lightboxImage.alt = e.target.alt;
        currentLightboxIndex = parseInt(e.target.closest('.fullscreen-image').dataset.imageIndex);
        lightbox.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    });
    
    lightboxClose.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', function(e) {
      if (e.target === lightbox) closeLightbox();
    });
    
    function closeLightbox() {
      lightbox.classList.remove('active');
      document.body.style.overflow = '';
    }
    
    lightboxPrev.addEventListener('click', function() {
      const images = document.querySelectorAll('.fullscreen-image img');
      currentLightboxIndex = (currentLightboxIndex - 1 + images.length) % images.length;
      const img = images[currentLightboxIndex];
      lightboxImage.src = img.dataset.zoomSrc || img.src;
    });
    
    lightboxNext.addEventListener('click', function() {
      const images = document.querySelectorAll('.fullscreen-image img');
      currentLightboxIndex = (currentLightboxIndex + 1) % images.length;
      const img = images[currentLightboxIndex];
      lightboxImage.src = img.dataset.zoomSrc || img.src;
    });
    
    document.addEventListener('keydown', function(e) {
      if (!lightbox.classList.contains('active')) return;
      if (e.key === 'Escape') closeLightbox();
      if (e.key === 'ArrowLeft') lightboxPrev.click();
      if (e.key === 'ArrowRight') lightboxNext.click();
    });
  }
  
  // Variant Selection
  const variantDataEl = document.getElementById('variant-data');
  if (!variantDataEl) return;
  
  const variantData = JSON.parse(variantDataEl.textContent);
  const variantSelector = document.querySelector('.variant-selector');
  const priceEl = document.querySelector('.product-price');
  const btnPriceEl = document.querySelector('.btn-price');
  const addToCartBtn = document.querySelector('#add-to-cart-btn');
  const stockStatus = document.querySelector('.stock-status');
  
  function updateVariant() {
    const selectedOptions = [];
    document.querySelectorAll('input[name^="option-"]:checked').forEach(input => {
      const pos = parseInt(input.name.match(/option-(\d+)/)[1]) - 1;
      selectedOptions[pos] = input.value.trim().toLowerCase();
    });
    
    const matchingVariant = variantData.variants.find(v => {
      const opts = [v.option1, v.option2, v.option3].map(o => o ? o.toLowerCase() : '');
      return selectedOptions.every((sel, i) => opts[i] === sel);
    });
    
    if (matchingVariant) {
      if (variantSelector) variantSelector.value = matchingVariant.id;
      if (priceEl) priceEl.innerHTML = matchingVariant.priceHtml;
      if (btnPriceEl) btnPriceEl.innerHTML = matchingVariant.priceHtml;
      
      if (addToCartBtn) {
        addToCartBtn.disabled = !matchingVariant.available;
        const btnText = addToCartBtn.querySelector('.btn-text');
        if (btnText) {
          btnText.textContent = matchingVariant.available ? 'Add to Cart' : 'Sold Out';
        }
      }
      
      if (stockStatus) {
        if (matchingVariant.available) {
          stockStatus.className = 'stock-status in-stock';
          stockStatus.textContent = '● Buy now orders shipped within 1-2 days.';
        } else {
          stockStatus.className = 'stock-status out-stock';
          stockStatus.textContent = '● Currently out of stock';
        }
      }
    }
  }
  
  document.querySelectorAll('input[name^="option-"]').forEach(input => {
    input.addEventListener('change', updateVariant);
  });
  
  // Add to Cart
  const productForm = document.querySelector('form[action*="/cart/add"]');
  const cartMessage = document.querySelector('.cart-message');
  
  if (productForm) {
    productForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(productForm);
      const addButton = productForm.querySelector('#add-to-cart-btn');
      const btnText = addButton.querySelector('.btn-text');
      const originalText = btnText.textContent;
      
      addButton.disabled = true;
      btnText.textContent = 'Adding...';
      
      if (cartMessage) {
        cartMessage.style.display = 'none';
        cartMessage.className = 'cart-message';
      }
      
      const addPromise = window.addToCartAndUpdate
        ? window.addToCartAndUpdate(formData)
        : fetch('/cart/add.js', { method: 'POST', body: formData }).then(r => r.json());
      
      addPromise
        .then(data => {
          if (cartMessage) {
            cartMessage.className = 'cart-message success';
            cartMessage.textContent = 'Added to cart!';
            cartMessage.style.display = 'block';
          }
          addButton.disabled = false;
          btnText.textContent = originalText;
          setTimeout(() => { if (cartMessage) cartMessage.style.display = 'none'; }, 3000);
        })
        .catch(error => {
          if (cartMessage) {
            cartMessage.className = 'cart-message error';
            cartMessage.textContent = 'Error adding to cart.';
            cartMessage.style.display = 'block';
          }
          addButton.disabled = false;
          btnText.textContent = originalText;
        });
    });
  }
});
{% endjavascript %}

{% schema %}
{
  "name": "t:general.product",
  "settings": [],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
