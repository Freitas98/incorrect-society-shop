{% comment %}
  Newsletter Content
  Usage: {% render 'newsletter-content' %}
{% endcomment %}

<!-- Social icons are shown in the left sidebar above the newsletter link -->

<h2 class="newsletter-heading">{{ 'newsletter.stay_connected_title' | t }}</h2>
<p class="newsletter-intro">{{ 'newsletter.intro_html' | t }}</p>

<div
  id="NewsletterContainer"
  class="contact-card newsletter-card u-text-center"
  data-adding="{{ 'theme.messages.adding' | t }}"
  data-success="{{ 'newsletter.success' | t }}"
  data-error="{{ 'newsletter.error' | t }}"
  data-verifying="{{ 'newsletter.verifying' | t }}"
  data-captcha="{{ 'newsletter.captcha_message' | t }}"
>
  <h3 class="newsletter-highlight">{{ 'newsletter.subscribe_now' | t }}</h3>
  <p class="newsletter-copy">
    {{ 'newsletter.subscribe_prompt' | t }}
  </p>

  {% form 'customer', id: 'NewsletterForm', class: 'contact-form newsletter-form', onsubmit: 'window.loadingScreen.show();' %}
    <input type="hidden" name="contact[tags]" value="newsletter_page">
    <input type="hidden" name="contact[accepts_marketing]" value="true">
    <input type="hidden" name="return_to" value="{{ request.path }}">

    {% if form.posted_successfully? %}
      <p class="newsletter-success newsletter-feedback" style="text-align: center; width: 100%;">
        Thank you for subscribing! Check your e-mail for your 10% discount.
      </p>
      <script>
        if (window.history.replaceState) {
          window.history.replaceState(null, null, window.location.pathname);
        }
        try {
          localStorage.setItem('newsletter_modal_status', 'subscribed');
        } catch(e){}
      </script>
    {% elsif form.errors %}
      <div class="newsletter-errors newsletter-feedback">
        {%- capture error_messages -%}{{ form.errors | default_errors }}{%- endcapture -%}
        {%- if error_messages contains 'taken' or error_messages contains 'already' -%}
          This email is already subscribed to our newsletter.
        {%- else -%}
          {{ error_messages }}
        {%- endif -%}
      </div>
    {% endif %}

    {% unless form.posted_successfully? %}
      <div class="newsletter-message newsletter-feedback" aria-live="polite" hidden></div>

      <input
        type="email"
        name="contact[email]"
        id="NewsletterForm-email"
        placeholder="{{ 'newsletter.email_placeholder' | t }}"
        autocomplete="email"
        required
      >

      <button
        type="submit"
        class="btn btn--primary"
      >
        {{ 'newsletter.subscribe_cta' | t }}
      </button>
    {% endunless %}
  {% endform %}
</div>

<p>
  <em class="text-soft text-small">{{ 'newsletter.unsubscribe_note' | t }}</em>
</p>

<div class="newsletter-social">
  <p>To stay updated, follow us on social media:</p>
  {% render 'social-icons', size: 32 %}
</div>
