<!doctype html>
<html lang="{{ request.locale.iso_code }}">
  <head>
    {% render 'css-variables' %}
    {{ 'critical.css' | asset_url | stylesheet_tag: preload: true }}
  {% render 'meta-tags' %}
  {{ content_for_header }}
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: var(--font-primary-family, sans-serif);
        color: #ffffff;
        background: #000000 {% if settings.password_background_image %}url('{{ settings.password_background_image | image_url }}'){% else %}url('https://cdn.shopify.com/s/files/1/0954/9840/4181/files/6.jpg?v=1764206051'){% endif %} center / cover no-repeat fixed;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        padding: 40px 20px;
      }

      .password-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        z-index: 0;
      }

      .password-wrapper {
        position: relative;
        z-index: 1;
        width: min(520px, 100%);
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 40px;
      }

      /* Rotating Logo */
      .password-logo-container {
        perspective: 1000px;
        width: 120px;
        height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 16px;
      }

      .password-logo {
        width: 100%;
        height: auto;
        display: block;
        animation: spin3D 2.5s infinite linear;
        transform-style: preserve-3d;
        filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.45));
      }

      @keyframes spin3D {
        0% {
          transform: rotateY(0deg);
        }
        100% {
          transform: rotateY(360deg);
        }
      }

      /* Timer Styles */
      .password-timer {
        display: none;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }

      .password-timer.active {
        display: flex;
      }

      .timer-display {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .timer-unit {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-width: 60px;
      }

      .timer-value {
        font-size: clamp(1.8rem, 4vw, 2.4rem);
        font-weight: 700;
        letter-spacing: 0.05em;
        line-height: 1.2;
      }

      .timer-label {
        font-size: 0.7rem;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        opacity: 0.7;
      }

      .timer-separator {
        font-size: clamp(1.8rem, 4vw, 2.4rem);
        font-weight: 700;
        line-height: 1.2;
        opacity: 0.5;
        align-self: flex-start;
      }

      /* Form Styles */
      .password-form {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        width: 100%;
      }

      .password-input-group {
        display: flex;
        width: 100%;
        max-width: 320px;
        border: 1px solid rgba(255, 255, 255, 0.7);
        border-radius: var(--style-border-radius-inputs);
        overflow: hidden;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(2px);
      }

      .password-input-group.hidden {
        display: none;
      }

      .password-input {
        flex: 1;
        padding: 14px 18px;
        background: transparent;
        border: none;
        color: #ffffff;
        font-size: 1rem;
        letter-spacing: 0.08em;
        min-width: 10px;
      }

      .password-input:focus {
        outline: none;
        border: none;
        box-shadow: none;
      }

      .password-input::placeholder {
        color: rgba(255, 255, 255, 0.55);
      }

      .password-arrow-btn {
        border: none;
        background: rgba(255, 255, 255, 0.15);
        color: #ffffff;
        font-size: 1.4rem;
        padding: 0 20px;
        cursor: pointer;
        transition: background 0.2s ease;
        height: 52px;
      }

      .password-arrow-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      /* Enter Button (Shop Open state) */
      .password-enter-btn {
        display: none;
        padding: 16px 48px;
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.7);
        border-radius: var(--style-border-radius-inputs);
        color: #ffffff;
        font-size: 1rem;
        font-weight: 600;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        cursor: pointer;
        transition: background 0.2s ease, transform 0.2s ease;
      }

      .password-enter-btn:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: scale(1.02);
      }

      .password-enter-btn.active {
        display: block;
      }

      @media (max-width: 480px) {
        body {
          padding: 15px 20px 30px;
        }

        .password-wrapper {
          gap: 20px;
        }

        .password-logo-container {
          width: 100px;
          height: 100px;
        }

        .password-input-group {
          max-width: 100%;
        }

        .timer-unit {
          min-width: 50px;
        }

        .timer-separator {
          display: none;
        }
      }
    </style>
    <meta name="google-site-verification" content="cQT3m4WAClIG7LVSb9jwTrsBaW3XHArBN_kgB6ZfcUg" />
  </head>
  <body>
    {% comment %} <div style="display: none;">{{ content_for_layout }}</div> {% endcomment %}
    <div class="password-overlay"></div>
    
    <div class="password-wrapper">
      <!-- Rotating Logo -->
      <div class="password-logo-container">
        <img
          src="{{ settings.logo_image | image_url | default: 'https://cdn.shopify.com/s/files/1/0954/9840/4181/files/incorrect-society-logo-white_120x120.png?v=1700343733' }} "
          alt="{{ shop.name | escape }}"
          class="password-logo"
          loading="eager"
          width="120"
          height="120"
        >
      </div>

      <!-- Timer (only visible when timer is active and shop not yet open) -->
      <div class="password-timer" id="password-timer">
        <div class="timer-display">
          <div class="timer-unit">
            <span class="timer-value" id="timer-days">00</span>
            <span class="timer-label">Days</span>
          </div>
          <span class="timer-separator">:</span>
          <div class="timer-unit">
            <span class="timer-value" id="timer-hours">00</span>
            <span class="timer-label">Hours</span>
          </div>
          <span class="timer-separator">:</span>
          <div class="timer-unit">
            <span class="timer-value" id="timer-minutes">00</span>
            <span class="timer-label">Min</span>
          </div>
          <span class="timer-separator">:</span>
          <div class="timer-unit">
            <span class="timer-value" id="timer-seconds">00</span>
            <span class="timer-label">Sec</span>
          </div>
        </div>
      </div>

      <!-- Password Form -->
      {% form 'storefront_password', class: 'password-form', id: 'password-form' %}
        <div class="password-input-group" id="password-input-group">
          <input
            class="password-input"
            name="password"
            id="password-input"
            type="password"
            autocomplete="current-password"
            placeholder="Password"
            required
          >
          <button type="submit" class="password-arrow-btn" id="password-submit-btn" aria-label="Submit password">
            &gt;
          </button>
        </div>
        
        <!-- Enter Button (visible when shop is open) -->
        <button type="submit" class="password-enter-btn" id="password-enter-btn">
          ENTER
        </button>
      {% endform %}
    </div>

    <script>
      (function() {
        // Configuration from Shopify theme settings
        const TIMER_ENABLED = {{ settings.password_timer_enabled | default: true }};
        const SHOP_OPEN_DATE = new Date('{{ settings.password_open_date | default: "2026-02-08T18:00:00+00:00" }}');
        const AUTO_PASSWORD = '{{ settings.password_auto_password | default: "FemaleAnxiety2026" }}';

        // Elements
        const timerEl = document.getElementById('password-timer');
        const inputGroup = document.getElementById('password-input-group');
        const enterBtn = document.getElementById('password-enter-btn');
        const passwordInput = document.getElementById('password-input');
        const daysEl = document.getElementById('timer-days');
        const hoursEl = document.getElementById('timer-hours');
        const minutesEl = document.getElementById('timer-minutes');
        const secondsEl = document.getElementById('timer-seconds');

        function padZero(num) {
          return num.toString().padStart(2, '0');
        }

        function updateTimer() {
          const now = new Date();
          const diff = SHOP_OPEN_DATE - now;

          if (diff <= 0) {
            // Shop is OPEN - show ENTER button, hide timer and password input
            showShopOpenState();
            return false;
          }

          // Calculate time remaining
          const days = Math.floor(diff / (1000 * 60 * 60 * 24));
          const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((diff % (1000 * 60)) / 1000);

          daysEl.textContent = padZero(days);
          hoursEl.textContent = padZero(hours);
          minutesEl.textContent = padZero(minutes);
          secondsEl.textContent = padZero(seconds);

          return true;
        }

        function showShopOpenState() {
          // Hide timer
          timerEl.classList.remove('active');
          // Hide password input group
          inputGroup.classList.add('hidden');
          // Show ENTER button
          enterBtn.classList.add('active');
          // Pre-fill password
          passwordInput.value = AUTO_PASSWORD;
          passwordInput.removeAttribute('required');
        }

        function showTimerState() {
          // Show timer
          timerEl.classList.add('active');
          // Show password input group
          inputGroup.classList.remove('hidden');
          // Hide ENTER button
          enterBtn.classList.remove('active');
        }

        function showDefaultState() {
          // Hide timer
          timerEl.classList.remove('active');
          // Show password input group
          inputGroup.classList.remove('hidden');
          // Hide ENTER button
          enterBtn.classList.remove('active');
        }

        function init() {
          const now = new Date();
          const isShopOpen = now >= SHOP_OPEN_DATE;

          if (isShopOpen) {
            // State 3: Shop is open
            showShopOpenState();
          } else if (TIMER_ENABLED) {
            // State 2: Timer is on (pre-sale period)
            showTimerState();
            updateTimer();
            setInterval(updateTimer, 1000);
          } else {
            // State 1: Default (no timer, just password)
            showDefaultState();
          }
        }

        // Initialize on DOM ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', init);
        } else {
          init();
        }
      })();
    </script>
  </body>
</html>
